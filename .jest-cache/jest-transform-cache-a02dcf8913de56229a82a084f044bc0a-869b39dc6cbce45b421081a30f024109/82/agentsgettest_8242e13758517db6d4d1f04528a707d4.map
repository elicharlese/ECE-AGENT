{"version":3,"sources":["/Users/elicharlese/CascadeProjects/ECE-AGENT/__tests__/api/agents.get.test.ts"],"sourcesContent":["// Mock NextResponse.json to produce a standard Response with JSON body\njest.mock('next/server', () => ({\n  NextResponse: {\n    json: (data: any, init?: ResponseInit & { status?: number }) =>\n      new Response(JSON.stringify(data), {\n        status: (init as any)?.status ?? 200,\n        headers: { 'content-type': 'application/json' },\n      }),\n  },\n}))\n\n// Mock getSupabaseServer to simulate authenticated user and DB calls\njest.mock('@/lib/supabase/server', () => {\n  const authGetUser = jest.fn(async () => ({ data: { user: { id: 'user-1' } }, error: null }))\n\n  // Build a chain: from('agents').select('*').eq('user_id', user.id).order('created_at', { ascending: false })\n  const order = jest.fn(async () => ({\n    data: [\n      {\n        id: 'agent-1',\n        user_id: 'user-1',\n        name: 'Test Agent',\n        description: null,\n        model: 'gpt-4o-mini',\n        avatar_url: null,\n        capabilities: [],\n        mcp_tools: [],\n        status: 'online',\n        system_prompt: null,\n        created_at: new Date().toISOString(),\n      },\n    ],\n    error: null,\n  }))\n  const eq = jest.fn(() => ({ order }))\n  const select = jest.fn(() => ({ eq, order }))\n  const from = jest.fn(() => ({ select }))\n\n  return {\n    getSupabaseServer: async () => ({\n      auth: { getUser: authGetUser },\n      from,\n      __mocks: { authGetUser, from, select, eq, order },\n    }),\n  }\n})\n\ndescribe('GET /api/agents', () => {\n  it('returns 200 with agents for authenticated user', async () => {\n    const { GET } = await import('@/app/api/agents/route')\n\n    const res = await GET()\n    expect(res.status).toBe(200)\n    const json = await res.json()\n    expect(Array.isArray(json.agents)).toBe(true)\n    expect(json.agents[0].name).toBe('Test Agent')\n  })\n\n  it('returns 401 when unauthorized', async () => {\n    const { getSupabaseServer } = await import('@/lib/supabase/server')\n    const supa: any = await getSupabaseServer()\n    supa.__mocks.authGetUser.mockImplementationOnce(async () => ({ data: { user: null }, error: null }))\n\n    const { GET } = await import('@/app/api/agents/route')\n    const res = await GET()\n    expect(res.status).toBe(401)\n    const json = await res.json()\n    expect(json.error).toBeDefined()\n  })\n})\n"],"names":["jest","mock","NextResponse","json","data","init","Response","JSON","stringify","status","headers","authGetUser","fn","user","id","error","order","user_id","name","description","model","avatar_url","capabilities","mcp_tools","system_prompt","created_at","Date","toISOString","eq","select","from","getSupabaseServer","auth","getUser","__mocks","describe","it","GET","res","expect","toBe","Array","isArray","agents","supa","mockImplementationOnce","toBeDefined"],"mappings":"AAAA,uEAAuE;;AACvEA,KAAKC,IAAI,CAAC,eAAe,IAAO,CAAA;QAC9BC,cAAc;YACZC,MAAM,CAACC,MAAWC,OAChB,IAAIC,SAASC,KAAKC,SAAS,CAACJ,OAAO;oBACjCK,QAAQ,AAACJ,MAAcI,UAAU;oBACjCC,SAAS;wBAAE,gBAAgB;oBAAmB;gBAChD;QACJ;IACF,CAAA;AAEA,qEAAqE;AACrEV,KAAKC,IAAI,CAAC,yBAAyB;IACjC,MAAMU,cAAcX,KAAKY,EAAE,CAAC,UAAa,CAAA;YAAER,MAAM;gBAAES,MAAM;oBAAEC,IAAI;gBAAS;YAAE;YAAGC,OAAO;QAAK,CAAA;IAEzF,6GAA6G;IAC7G,MAAMC,QAAQhB,KAAKY,EAAE,CAAC,UAAa,CAAA;YACjCR,MAAM;gBACJ;oBACEU,IAAI;oBACJG,SAAS;oBACTC,MAAM;oBACNC,aAAa;oBACbC,OAAO;oBACPC,YAAY;oBACZC,cAAc,EAAE;oBAChBC,WAAW,EAAE;oBACbd,QAAQ;oBACRe,eAAe;oBACfC,YAAY,IAAIC,OAAOC,WAAW;gBACpC;aACD;YACDZ,OAAO;QACT,CAAA;IACA,MAAMa,KAAK5B,KAAKY,EAAE,CAAC,IAAO,CAAA;YAAEI;QAAM,CAAA;IAClC,MAAMa,SAAS7B,KAAKY,EAAE,CAAC,IAAO,CAAA;YAAEgB;YAAIZ;QAAM,CAAA;IAC1C,MAAMc,OAAO9B,KAAKY,EAAE,CAAC,IAAO,CAAA;YAAEiB;QAAO,CAAA;IAErC,OAAO;QACLE,mBAAmB,UAAa,CAAA;gBAC9BC,MAAM;oBAAEC,SAAStB;gBAAY;gBAC7BmB;gBACAI,SAAS;oBAAEvB;oBAAamB;oBAAMD;oBAAQD;oBAAIZ;gBAAM;YAClD,CAAA;IACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEAmB,SAAS,mBAAmB;IAC1BC,GAAG,kDAAkD;QACnD,MAAM,EAAEC,GAAG,EAAE,GAAG,MAAM,mEAAA,QAAO;QAE7B,MAAMC,MAAM,MAAMD;QAClBE,OAAOD,IAAI7B,MAAM,EAAE+B,IAAI,CAAC;QACxB,MAAMrC,OAAO,MAAMmC,IAAInC,IAAI;QAC3BoC,OAAOE,MAAMC,OAAO,CAACvC,KAAKwC,MAAM,GAAGH,IAAI,CAAC;QACxCD,OAAOpC,KAAKwC,MAAM,CAAC,EAAE,CAACzB,IAAI,EAAEsB,IAAI,CAAC;IACnC;IAEAJ,GAAG,iCAAiC;QAClC,MAAM,EAAEL,iBAAiB,EAAE,GAAG,MAAM,mEAAA,QAAO;QAC3C,MAAMa,OAAY,MAAMb;QACxBa,KAAKV,OAAO,CAACvB,WAAW,CAACkC,sBAAsB,CAAC,UAAa,CAAA;gBAAEzC,MAAM;oBAAES,MAAM;gBAAK;gBAAGE,OAAO;YAAK,CAAA;QAEjG,MAAM,EAAEsB,GAAG,EAAE,GAAG,MAAM,mEAAA,QAAO;QAC7B,MAAMC,MAAM,MAAMD;QAClBE,OAAOD,IAAI7B,MAAM,EAAE+B,IAAI,CAAC;QACxB,MAAMrC,OAAO,MAAMmC,IAAInC,IAAI;QAC3BoC,OAAOpC,KAAKY,KAAK,EAAE+B,WAAW;IAChC;AACF"}