{"version":3,"sources":["/Users/elicharlese/CascadeProjects/ECE-AGENT/app/api/agents/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { z } from \"zod\"\nimport { getSupabaseServer } from \"@/lib/supabase/server\"\nimport { AgentInsertSchema } from \"@/types/agent\"\n\nexport async function GET() {\n  try {\n    const supabase = await getSupabaseServer()\n    const {\n      data: { user },\n      error: userError,\n    } = await supabase.auth.getUser()\n\n    if (userError || !user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const { data, error } = await supabase\n      .from(\"agents\")\n      .select(\"*\")\n      .eq(\"user_id\", user.id)\n      .order(\"created_at\", { ascending: false })\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    return NextResponse.json({ agents: data ?? [] })\n  } catch (e: any) {\n    return NextResponse.json({ error: e?.message ?? \"Server error\" }, { status: 500 })\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    const supabase = await getSupabaseServer()\n    const {\n      data: { user },\n      error: userError,\n    } = await supabase.auth.getUser()\n\n    if (userError || !user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const json = await req.json()\n    const parsed = AgentInsertSchema.safeParse(json)\n\n    if (!parsed.success) {\n      return NextResponse.json({ error: parsed.error.flatten() }, { status: 400 })\n    }\n\n    const payload = {\n      user_id: user.id,\n      name: parsed.data.name,\n      description: parsed.data.description ?? null,\n      model: parsed.data.model ?? null,\n      avatar_url: parsed.data.avatar_url ?? null,\n      capabilities: parsed.data.capabilities ?? [],\n      mcp_tools: parsed.data.mcp_tools ?? [],\n      status: parsed.data.status,\n      system_prompt: parsed.data.system_prompt ?? null,\n    }\n\n    const { data, error } = await supabase.from(\"agents\").insert(payload).select(\"*\").single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    return NextResponse.json({ agent: data }, { status: 201 })\n  } catch (e: any) {\n    return NextResponse.json({ error: e?.message ?? \"Server error\" }, { status: 500 })\n  }\n}\n"],"names":["GET","POST","supabase","getSupabaseServer","data","user","error","userError","auth","getUser","NextResponse","json","status","from","select","eq","id","order","ascending","message","agents","e","req","parsed","AgentInsertSchema","safeParse","success","flatten","payload","user_id","name","description","model","avatar_url","capabilities","mcp_tools","system_prompt","insert","single","agent"],"mappings":"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"}