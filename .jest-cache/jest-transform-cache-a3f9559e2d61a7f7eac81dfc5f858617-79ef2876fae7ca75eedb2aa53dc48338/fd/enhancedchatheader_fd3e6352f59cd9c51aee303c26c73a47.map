{"version":3,"sources":["/Users/elicharlese/CascadeProjects/AGENT/components/chat/enhanced-chat-header.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState } from \"react\"\nimport { \n  Phone, \n  Video, \n  Bot, \n  SquareArrowOutUpRight,\n  Pin,\n  Settings,\n  ChevronDown,\n  ChevronUp,\n  MoreVertical,\n  Users,\n  UserPlus,\n  Shield,\n  Bell,\n  Archive,\n  Trash2,\n  Box\n} from \"lucide-react\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport {\n  Card,\n  CardContent,\n} from \"@/components/ui/card\"\nimport { cn } from \"@/lib/utils\"\nimport { CreditsPopover } from \"@/components/credits/CreditsPopover\"\nimport { isFeatureEnabled, FEATURES } from '@/lib/feature-flags'\n\ninterface EnhancedChatHeaderProps {\n  chatInfo: {\n    id: string\n    name: string\n    type?: \"direct\" | \"group\" | \"ai\" | \"combination\"\n    participants?: number\n    avatar?: string\n    status?: \"online\" | \"offline\" | \"busy\" | \"away\"\n    customStatus?: string\n    isAgent?: boolean\n  }\n  pinnedMessages: Array<{\n    id: string\n    content: string\n    sender: string\n    timestamp: Date\n  }>\n  onPhoneCall: () => void\n  onVideoCall: () => void\n  onOpenAgentSettings: () => void\n  onPopout: () => void\n  onOpenAppLauncher: () => void\n  onInviteUsers?: () => void\n  isMobile?: boolean\n  onToggleHeadsetView: () => void\n  isHeadsetView?: boolean\n}\n\nexport function EnhancedChatHeader({\n  chatInfo,\n  pinnedMessages,\n  onPhoneCall,\n  onVideoCall,\n  onOpenAgentSettings,\n  onPopout,\n  onOpenAppLauncher,\n  onInviteUsers,\n  isMobile = false,\n  onToggleHeadsetView,\n  isHeadsetView = false\n}: EnhancedChatHeaderProps) {\n  const [showPinnedBanner, setShowPinnedBanner] = useState(pinnedMessages.length > 0)\n  const [expandedPins, setExpandedPins] = useState(false)\n\n  const getStatusColor = (status?: string) => {\n    switch (status) {\n      case \"online\": return \"bg-green-500\"\n      case \"busy\": return \"bg-red-500\"\n      case \"away\": return \"bg-yellow-500\"\n      default: return \"bg-gray-400\"\n    }\n  }\n\n  const getChatTypeIcon = () => {\n    switch (chatInfo.type) {\n      case \"group\": return <Users className=\"h-3 w-3\" />\n      case \"ai\": return <Bot className=\"h-3 w-3\" />\n      case \"combination\": return <Shield className=\"h-3 w-3\" />\n      default: return null\n    }\n  }\n\n  return (\n    <div className=\"flex flex-col bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700\">\n      {/* Main Header */}\n      <div className={cn(\n        \"flex items-center justify-between\",\n        isMobile ? \"px-3 py-2 safe-area-inset-top\" : \"px-4 py-3\"\n      )}>\n        {/* Left Section - User/Chat Info */}\n        <div className=\"flex items-center gap-3 min-w-0 flex-1\">\n          <div className=\"relative\">\n            <Avatar className={isMobile ? \"h-9 w-9\" : \"h-10 w-10\"}>\n              <AvatarImage src={chatInfo.avatar} />\n              <AvatarFallback className=\"bg-gradient-to-br from-blue-500 to-purple-600 text-white\">\n                {chatInfo.name.split(\" \").map(n => n[0]).join(\"\")}\n              </AvatarFallback>\n            </Avatar>\n            {chatInfo.status && (\n              <div className={cn(\n                \"absolute -bottom-0.5 -right-0.5 h-3 w-3 border-2 border-white dark:border-gray-800 rounded-full\",\n                getStatusColor(chatInfo.status)\n              )} />\n            )}\n          </div>\n\n          <div className=\"min-w-0 flex-1\">\n            <div className=\"flex items-center gap-2\">\n              <h3 className=\"font-semibold text-sm truncate\">{chatInfo.name}</h3>\n              {getChatTypeIcon()}\n              {chatInfo.isAgent && (\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  AI Agent\n                </Badge>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400\">\n              {chatInfo.customStatus ? (\n                <span className=\"truncate\">{chatInfo.customStatus}</span>\n              ) : (\n                <>\n                  {chatInfo.type === \"group\" && (\n                    <span>{chatInfo.participants || 0} participants</span>\n                  )}\n                  {chatInfo.status && <span>{chatInfo.status}</span>}\n                </>\n              )}\n              {pinnedMessages.length > 0 && (\n                <>\n                  <span>â€¢</span>\n                  <button\n                    onClick={() => setExpandedPins(!expandedPins)}\n                    className=\"flex items-center gap-1 hover:text-gray-700 dark:hover:text-gray-200 transition\"\n                  >\n                    <Pin className=\"h-3 w-3\" />\n                    {pinnedMessages.length} pinned\n                  </button>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Right Section - Actions */}\n        <div className=\"flex items-center gap-1\">\n          {chatInfo.type === \"group\" && onInviteUsers && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onInviteUsers}\n              title=\"Invite users\"\n            >\n              <UserPlus className=\"h-4 w-4\" />\n            </Button>\n          )}\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onPhoneCall}\n            title=\"Voice call\"\n          >\n            <Phone className=\"h-4 w-4\" />\n          </Button>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onVideoCall}\n            title=\"Video call\"\n          >\n            <Video className=\"h-4 w-4\" />\n          </Button>\n\n          {chatInfo.isAgent && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onOpenAgentSettings}\n              title=\"Agent settings\"\n            >\n              <Settings className=\"h-4 w-4\" />\n            </Button>\n          )}\n\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onPopout}\n            title=\"Open in new window\"\n            aria-label=\"Open in new window\"\n          >\n            <SquareArrowOutUpRight className=\"h-4 w-4\" />\n          </Button>\n\n          {/* 3D Headset Toggle (desktop only, gated by feature flag) */}\n          {!isMobile && isFeatureEnabled(FEATURES.IMMERSIVE_CHAT) && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onToggleHeadsetView}\n              title={isHeadsetView ? \"Exit 3D Headset view\" : \"Enter 3D Headset view\"}\n              aria-label={isHeadsetView ? \"Exit 3D Headset view\" : \"Enter 3D Headset view\"}\n              aria-pressed={isHeadsetView}\n              className={cn(isHeadsetView ? \"text-blue-600 dark:text-blue-400\" : \"\")}\n            >\n              <Box className=\"h-4 w-4\" />\n            </Button>\n          )}\n\n          <CreditsPopover />\n\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\">\n                <MoreVertical className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\n              <DropdownMenuLabel>Chat Options</DropdownMenuLabel>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={onOpenAppLauncher}>\n                <Bot className=\"h-4 w-4 mr-2\" />\n                Launch App\n              </DropdownMenuItem>\n              <DropdownMenuItem>\n                <Bell className=\"h-4 w-4 mr-2\" />\n                Mute Notifications\n              </DropdownMenuItem>\n              <DropdownMenuItem>\n                <Archive className=\"h-4 w-4 mr-2\" />\n                Archive Chat\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem className=\"text-red-600\">\n                <Trash2 className=\"h-4 w-4 mr-2\" />\n                Delete Chat\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </div>\n\n      {/* Pinned Messages Banner */}\n      {showPinnedBanner && pinnedMessages.length > 0 && (\n        <div className={cn(\n          \"border-t border-gray-100 dark:border-gray-700 bg-amber-50 dark:bg-amber-900/20\",\n          expandedPins ? \"max-h-64\" : \"max-h-12\",\n          \"transition-all duration-200 overflow-hidden\"\n        )}>\n          <div className=\"px-4 py-2\">\n            <div className=\"flex items-center justify-between mb-1\">\n              <div className=\"flex items-center gap-2\">\n                <Pin className=\"h-3 w-3 text-amber-600 dark:text-amber-400\" />\n                <span className=\"text-xs font-medium text-amber-700 dark:text-amber-300\">\n                  Pinned Messages ({pinnedMessages.length})\n                </span>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-6 px-2\"\n                  onClick={() => setShowPinnedBanner(false)}\n                >\n                  <span className=\"text-xs\">Hide</span>\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-6 w-6 p-0\"\n                  onClick={() => setExpandedPins(!expandedPins)}\n                >\n                  {expandedPins ? (\n                    <ChevronUp className=\"h-3 w-3\" />\n                  ) : (\n                    <ChevronDown className=\"h-3 w-3\" />\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            {expandedPins ? (\n              <div className=\"space-y-2 mt-2 max-h-48 overflow-y-auto\">\n                {pinnedMessages.map(msg => (\n                  <Card key={msg.id} className=\"bg-white dark:bg-gray-800 border-amber-200 dark:border-amber-800\">\n                    <CardContent className=\"p-2\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"min-w-0 flex-1\">\n                          <p className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">\n                            {msg.sender}\n                          </p>\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-0.5\">\n                            {msg.content}\n                          </p>\n                        </div>\n                        <span className=\"text-xs text-gray-500 ml-2\">\n                          {msg.timestamp.toLocaleTimeString([], { \n                            hour: '2-digit', \n                            minute: '2-digit' \n                          })}\n                        </span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-xs text-amber-700 dark:text-amber-300 truncate\">\n                Latest: {pinnedMessages[0]?.content}\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"names":["EnhancedChatHeader","chatInfo","pinnedMessages","onPhoneCall","onVideoCall","onOpenAgentSettings","onPopout","onOpenAppLauncher","onInviteUsers","isMobile","onToggleHeadsetView","isHeadsetView","showPinnedBanner","setShowPinnedBanner","useState","length","expandedPins","setExpandedPins","getStatusColor","status","getChatTypeIcon","type","Users","className","Bot","Shield","div","cn","Avatar","AvatarImage","src","avatar","AvatarFallback","name","split","map","n","join","h3","isAgent","Badge","variant","customStatus","span","participants","button","onClick","Pin","Button","size","title","UserPlus","Phone","Video","Settings","aria-label","SquareArrowOutUpRight","isFeatureEnabled","FEATURES","IMMERSIVE_CHAT","aria-pressed","Box","CreditsPopover","DropdownMenu","DropdownMenuTrigger","asChild","MoreVertical","DropdownMenuContent","align","DropdownMenuLabel","DropdownMenuSeparator","DropdownMenuItem","Bell","Archive","Trash2","ChevronUp","ChevronDown","msg","Card","CardContent","p","sender","content","timestamp","toLocaleTimeString","hour","minute","id"],"mappings":"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"}