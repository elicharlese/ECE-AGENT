{"version":3,"sources":["/Users/elicharlese/CascadeProjects/AGENT/components/chat/Headset3DView.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useEffect, useMemo, useRef, useState } from \"react\"\n\nexport type HeadsetItem = {\n  id: string\n  content: string\n  timestamp: Date\n  isOwn: boolean\n}\n\nexport type Headset3DViewProps = {\n  items: HeadsetItem[]\n}\n\n// Lightweight CSS 3D view to avoid heavy deps; future patches can swap to r3f/three\nexport function Headset3DView({ items }: Headset3DViewProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null)\n  const [rotation, setRotation] = useState<{ x: number; y: number }>({ x: -8, y: 20 })\n  const [dragging, setDragging] = useState(false)\n  const lastPos = useRef<{ x: number; y: number } | null>(null)\n  const rotationRef = useRef<{ x: number; y: number }>(rotation)\n  const rafId = useRef<number | null>(null)\n  const pendingDelta = useRef<{ dx: number; dy: number } | null>(null)\n  const [radius, setRadius] = useState<number>(420)\n\n  const visible = useMemo(() => items.slice(-24), [items])\n\n  // Keep ref in sync\n  useEffect(() => {\n    rotationRef.current = rotation\n  }, [rotation])\n\n  // Responsive radius based on container size\n  useEffect(() => {\n    const el = containerRef.current\n    if (!el || typeof ResizeObserver === 'undefined') return\n    const ro = new ResizeObserver((entries) => {\n      const cr = entries[0]?.contentRect\n      if (!cr) return\n      const size = Math.min(cr.width, cr.height)\n      // Clamp for readability; larger containers get a larger circle but bounded\n      const r = Math.max(220, Math.min(520, Math.floor(size / 2.6)))\n      setRadius(r)\n    })\n    ro.observe(el)\n    return () => ro.disconnect()\n  }, [])\n\n  const onPointerDown: React.PointerEventHandler<HTMLDivElement> = (e) => {\n    setDragging(true)\n    lastPos.current = { x: e.clientX, y: e.clientY }\n    ;(e.target as HTMLElement)?.setPointerCapture?.(e.pointerId)\n  }\n  const onPointerMove: React.PointerEventHandler<HTMLDivElement> = (e) => {\n    if (!dragging || !lastPos.current) return\n    const dx = e.clientX - lastPos.current.x\n    const dy = e.clientY - lastPos.current.y\n    lastPos.current = { x: e.clientX, y: e.clientY }\n    // Accumulate deltas and apply via rAF for smoother updates\n    const prev = pendingDelta.current\n    pendingDelta.current = {\n      dx: (prev?.dx || 0) + dx,\n      dy: (prev?.dy || 0) + dy,\n    }\n    if (rafId.current == null) {\n      rafId.current = requestAnimationFrame(() => {\n        rafId.current = null\n        const delta = pendingDelta.current\n        pendingDelta.current = null\n        if (!delta) return\n        const cur = rotationRef.current\n        const nextX = Math.max(-45, Math.min(45, cur.x - delta.dy * 0.15))\n        const nextY = cur.y + delta.dx * 0.2\n        setRotation({ x: nextX, y: nextY })\n      })\n    }\n  }\n  const onPointerUp: React.PointerEventHandler<HTMLDivElement> = (e) => {\n    setDragging(false)\n    lastPos.current = null\n    ;(e.target as HTMLElement)?.releasePointerCapture?.(e.pointerId)\n  }\n  const onPointerLeave: React.PointerEventHandler<HTMLDivElement> = (e) => {\n    if (!dragging) return\n    onPointerUp(e)\n  }\n\n  const onKeyDown: React.KeyboardEventHandler<HTMLDivElement> = (e) => {\n    let handled = true\n    const step = 4\n    if (e.key === 'ArrowLeft') {\n      setRotation((r) => ({ ...r, y: r.y - step }))\n    } else if (e.key === 'ArrowRight') {\n      setRotation((r) => ({ ...r, y: r.y + step }))\n    } else if (e.key === 'ArrowUp') {\n      setRotation((r) => ({ ...r, x: Math.max(-45, r.x - step) }))\n    } else if (e.key === 'ArrowDown') {\n      setRotation((r) => ({ ...r, x: Math.min(45, r.x + step) }))\n    } else {\n      handled = false\n    }\n    if (handled) e.preventDefault()\n  }\n\n  return (\n    <div className=\"absolute inset-0 bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white\">\n      <div className=\"absolute inset-0 perspective-[1000px] overflow-hidden\" ref={containerRef}\n        onPointerDown={onPointerDown}\n        onPointerMove={onPointerMove}\n        onPointerUp={onPointerUp}\n        onPointerCancel={onPointerUp}\n        onPointerLeave={onPointerLeave}\n        onKeyDown={onKeyDown}\n        aria-label=\"3D Headset Chat Space\"\n        role=\"region\"\n        aria-roledescription=\"3D immersive chat space\"\n        aria-describedby=\"immersive-3d-instructions\"\n        aria-keyshortcuts=\"ArrowLeft, ArrowRight, ArrowUp, ArrowDown\"\n        tabIndex={0}\n      >\n        <div\n          className=\"absolute left-1/2 top-1/2 origin-center will-change-transform\"\n          style={{\n            transformStyle: \"preserve-3d\",\n            transform: `translate(-50%, -50%) rotateX(${rotation.x}deg) rotateY(${rotation.y}deg)`,\n          }}\n        >\n          {visible.map((item, idx) => {\n            const angle = (idx / visible.length) * Math.PI * 2\n            const x = Math.sin(angle) * radius\n            const z = Math.cos(angle) * radius\n            const rotY = (angle * 180) / Math.PI\n            return (\n              <div\n                key={item.id}\n                className=\"absolute w-64 h-40 p-3 rounded-lg shadow-lg border border-white/10\"\n                style={{\n                  transformStyle: \"preserve-3d\",\n                  transform: `translate3d(${x}px, ${Math.sin(angle * 2) * 30}px, ${z}px) rotateY(${rotY}deg)`,\n                  background: item.isOwn ? \"linear-gradient(135deg, #1f2937, #374151)\" : \"linear-gradient(135deg, #111827, #1f2937)\",\n                }}\n                title={item.content.slice(0, 60)}\n                aria-label={`Message card ${idx + 1}`}\n              >\n                <div className=\"text-[10px] opacity-70\">{item.timestamp.toLocaleString()}</div>\n                <div className=\"text-xs mt-1 line-clamp-5 break-words\">\n                  {item.content}\n                </div>\n                <div className=\"absolute inset-0 pointer-events-none border border-white/5 rounded-lg\" style={{ transform: \"translateZ(1px)\" }} />\n              </div>\n            )\n          })}\n        </div>\n\n        {/* HUD */}\n        <div id=\"immersive-3d-instructions\" className=\"absolute left-1/2 -translate-x-1/2 bottom-4 text-[11px] text-gray-300/90\">\n          Drag (mouse) or use arrow keys to rotate. Press the Headset button again to exit.\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":["Headset3DView","items","containerRef","useRef","rotation","setRotation","useState","x","y","dragging","setDragging","lastPos","rotationRef","rafId","pendingDelta","radius","setRadius","visible","useMemo","slice","useEffect","current","el","ResizeObserver","ro","entries","cr","contentRect","size","Math","min","width","height","r","max","floor","observe","disconnect","onPointerDown","e","clientX","clientY","target","setPointerCapture","pointerId","onPointerMove","dx","dy","prev","requestAnimationFrame","delta","cur","nextX","nextY","onPointerUp","releasePointerCapture","onPointerLeave","onKeyDown","handled","step","key","preventDefault","div","className","ref","onPointerCancel","aria-label","role","aria-roledescription","aria-describedby","aria-keyshortcuts","tabIndex","style","transformStyle","transform","map","item","idx","angle","length","PI","sin","z","cos","rotY","background","isOwn","title","content","timestamp","toLocaleString","id"],"mappings":"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"}