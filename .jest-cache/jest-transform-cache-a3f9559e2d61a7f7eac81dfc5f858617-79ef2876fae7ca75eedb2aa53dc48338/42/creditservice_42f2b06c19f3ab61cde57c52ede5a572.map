{"version":3,"sources":["/Users/elicharlese/CascadeProjects/AGENT/services/credit-service.ts"],"sourcesContent":["import { supabase } from '@/lib/supabase/client'\nimport type { CreditBalance } from '@/src/types/credits'\n\nexport async function getCreditBalance(): Promise<CreditBalance> {\n  const { data: auth } = await supabase.auth.getUser()\n  const userId = auth.user?.id\n  if (!userId) return { userId: '', balance: 0 }\n\n  const { data, error } = await supabase\n    .from('user_credits')\n    .select('balance')\n    .eq('user_id', userId)\n    .single()\n\n  if (error || !data) return { userId, balance: 0 }\n  return { userId, balance: data.balance }\n}\n\nexport async function consumeCredits(amount: number, metadata: Record<string, any> = {}): Promise<number> {\n  if (!Number.isFinite(amount) || amount <= 0) throw new Error('Invalid amount')\n  const { data: auth } = await supabase.auth.getUser()\n  const userId = auth.user?.id\n  if (!userId) throw new Error('Not authenticated')\n\n  const { data, error } = await supabase.rpc('consume_credits', {\n    p_user_id: userId,\n    p_amount: Math.floor(amount),\n    p_metadata: metadata,\n  })\n\n  if (error) throw error\n  return data as number\n}\n"],"names":["consumeCredits","getCreditBalance","data","auth","supabase","getUser","userId","user","id","balance","error","from","select","eq","single","amount","metadata","Number","isFinite","Error","rpc","p_user_id","p_amount","Math","floor","p_metadata"],"mappings":";;;;;;;;;;;IAkBsBA,cAAc;eAAdA;;IAfAC,gBAAgB;eAAhBA;;;wBAHG;AAGlB,eAAeA;IACpB,MAAM,EAAEC,MAAMC,IAAI,EAAE,GAAG,MAAMC,gBAAQ,CAACD,IAAI,CAACE,OAAO;IAClD,MAAMC,SAASH,KAAKI,IAAI,EAAEC;IAC1B,IAAI,CAACF,QAAQ,OAAO;QAAEA,QAAQ;QAAIG,SAAS;IAAE;IAE7C,MAAM,EAAEP,IAAI,EAAEQ,KAAK,EAAE,GAAG,MAAMN,gBAAQ,CACnCO,IAAI,CAAC,gBACLC,MAAM,CAAC,WACPC,EAAE,CAAC,WAAWP,QACdQ,MAAM;IAET,IAAIJ,SAAS,CAACR,MAAM,OAAO;QAAEI;QAAQG,SAAS;IAAE;IAChD,OAAO;QAAEH;QAAQG,SAASP,KAAKO,OAAO;IAAC;AACzC;AAEO,eAAeT,eAAee,MAAc,EAAEC,WAAgC,CAAC,CAAC;IACrF,IAAI,CAACC,OAAOC,QAAQ,CAACH,WAAWA,UAAU,GAAG,MAAM,IAAII,MAAM;IAC7D,MAAM,EAAEjB,MAAMC,IAAI,EAAE,GAAG,MAAMC,gBAAQ,CAACD,IAAI,CAACE,OAAO;IAClD,MAAMC,SAASH,KAAKI,IAAI,EAAEC;IAC1B,IAAI,CAACF,QAAQ,MAAM,IAAIa,MAAM;IAE7B,MAAM,EAAEjB,IAAI,EAAEQ,KAAK,EAAE,GAAG,MAAMN,gBAAQ,CAACgB,GAAG,CAAC,mBAAmB;QAC5DC,WAAWf;QACXgB,UAAUC,KAAKC,KAAK,CAACT;QACrBU,YAAYT;IACd;IAEA,IAAIN,OAAO,MAAMA;IACjB,OAAOR;AACT"}