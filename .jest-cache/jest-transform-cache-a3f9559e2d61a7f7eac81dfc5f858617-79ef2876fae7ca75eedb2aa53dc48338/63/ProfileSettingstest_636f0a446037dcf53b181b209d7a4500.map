{"version":3,"sources":["/Users/elicharlese/CascadeProjects/AGENT/__tests__/components/ProfileSettings.test.tsx"],"sourcesContent":["import React from 'react'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\n\nimport { ProfileSettings } from '@/components/profile/ProfileSettings'\n\njest.mock('sonner', () => ({\n  toast: {\n    success: jest.fn(),\n    error: jest.fn(),\n  },\n}))\n\nconst { toast } = jest.requireMock('sonner') as { toast: { success: jest.Mock; error: jest.Mock } }\n\ndescribe('ProfileSettings', () => {\n  beforeEach(() => {\n    jest.clearAllMocks()\n  })\n\n  it('updates profile on valid submit and shows success toast', async () => {\n    render(<ProfileSettings />)\n\n    // Wait for initial GET to populate values\n    await screen.findByDisplayValue('Old Name')\n    await screen.findByDisplayValue('olduser')\n\n    // Change a couple of fields\n    fireEvent.change(screen.getByLabelText('Display name'), { target: { value: 'New Name' } })\n    fireEvent.change(screen.getByLabelText('Username'), { target: { value: 'new_user' } })\n\n    // Submit\n    fireEvent.click(screen.getByRole('button', { name: 'Save changes' }))\n\n    await waitFor(() => {\n      expect(toast.success).toHaveBeenCalledWith('Profile updated')\n    })\n\n    // Values should be reset from PUT response (MSW echoes back what we sent)\n    await screen.findByDisplayValue('New Name')\n    await screen.findByDisplayValue('new_user')\n  })\n\n  it('shows inline zod error messages for invalid inputs', async () => {\n    render(<ProfileSettings />)\n\n    // Wait for initial GET to populate values\n    await screen.findByDisplayValue('Old Name')\n\n    // Enter invalid values\n    fireEvent.change(screen.getByLabelText('Username'), { target: { value: 'A' } }) // too short\n    fireEvent.change(screen.getByLabelText('Avatar URL'), { target: { value: 'not-a-url' } }) // invalid url\n    fireEvent.change(screen.getByLabelText('Solana Address'), { target: { value: 'short' } }) // too short\n\n    // Submit to trigger validation\n    fireEvent.click(screen.getByRole('button', { name: 'Save changes' }))\n\n    // Default zod messages are fine to assert against\n    expect(await screen.findByText(/at least 3 character\\(s\\)/i)).toBeInTheDocument()\n    expect(screen.getByText(/invalid url/i)).toBeInTheDocument()\n    expect(await screen.findByText(/at least 32 character\\(s\\)/i)).toBeInTheDocument()\n\n    // Ensure no server toast fired for client-side validation\n    expect(toast.success).not.toHaveBeenCalled()\n    expect(toast.error).not.toHaveBeenCalled()\n  })\n})\n"],"names":["jest","mock","toast","success","fn","error","requireMock","describe","beforeEach","clearAllMocks","it","render","ProfileSettings","screen","findByDisplayValue","fireEvent","change","getByLabelText","target","value","click","getByRole","name","waitFor","expect","toHaveBeenCalledWith","findByText","toBeInTheDocument","getByText","not","toHaveBeenCalled"],"mappings":";AAKAA,KAAKC,IAAI,CAAC,UAAU,IAAO,CAAA;QACzBC,OAAO;YACLC,SAASH,KAAKI,EAAE;YAChBC,OAAOL,KAAKI,EAAE;QAChB;IACF,CAAA;;;;;8DAVkB;wBACiC;iCAEnB;;;;;;AAShC,MAAM,EAAEF,KAAK,EAAE,GAAGF,KAAKM,WAAW,CAAC;AAEnCC,SAAS,mBAAmB;IAC1BC,WAAW;QACTR,KAAKS,aAAa;IACpB;IAEAC,GAAG,2DAA2D;QAC5DC,IAAAA,cAAM,gBAAC,qBAACC,gCAAe;QAEvB,0CAA0C;QAC1C,MAAMC,cAAM,CAACC,kBAAkB,CAAC;QAChC,MAAMD,cAAM,CAACC,kBAAkB,CAAC;QAEhC,4BAA4B;QAC5BC,iBAAS,CAACC,MAAM,CAACH,cAAM,CAACI,cAAc,CAAC,iBAAiB;YAAEC,QAAQ;gBAAEC,OAAO;YAAW;QAAE;QACxFJ,iBAAS,CAACC,MAAM,CAACH,cAAM,CAACI,cAAc,CAAC,aAAa;YAAEC,QAAQ;gBAAEC,OAAO;YAAW;QAAE;QAEpF,SAAS;QACTJ,iBAAS,CAACK,KAAK,CAACP,cAAM,CAACQ,SAAS,CAAC,UAAU;YAAEC,MAAM;QAAe;QAElE,MAAMC,IAAAA,eAAO,EAAC;YACZC,OAAOtB,MAAMC,OAAO,EAAEsB,oBAAoB,CAAC;QAC7C;QAEA,0EAA0E;QAC1E,MAAMZ,cAAM,CAACC,kBAAkB,CAAC;QAChC,MAAMD,cAAM,CAACC,kBAAkB,CAAC;IAClC;IAEAJ,GAAG,sDAAsD;QACvDC,IAAAA,cAAM,gBAAC,qBAACC,gCAAe;QAEvB,0CAA0C;QAC1C,MAAMC,cAAM,CAACC,kBAAkB,CAAC;QAEhC,uBAAuB;QACvBC,iBAAS,CAACC,MAAM,CAACH,cAAM,CAACI,cAAc,CAAC,aAAa;YAAEC,QAAQ;gBAAEC,OAAO;YAAI;QAAE,GAAG,YAAY;;QAC5FJ,iBAAS,CAACC,MAAM,CAACH,cAAM,CAACI,cAAc,CAAC,eAAe;YAAEC,QAAQ;gBAAEC,OAAO;YAAY;QAAE,GAAG,cAAc;;QACxGJ,iBAAS,CAACC,MAAM,CAACH,cAAM,CAACI,cAAc,CAAC,mBAAmB;YAAEC,QAAQ;gBAAEC,OAAO;YAAQ;QAAE,GAAG,YAAY;;QAEtG,+BAA+B;QAC/BJ,iBAAS,CAACK,KAAK,CAACP,cAAM,CAACQ,SAAS,CAAC,UAAU;YAAEC,MAAM;QAAe;QAElE,kDAAkD;QAClDE,OAAO,MAAMX,cAAM,CAACa,UAAU,CAAC,+BAA+BC,iBAAiB;QAC/EH,OAAOX,cAAM,CAACe,SAAS,CAAC,iBAAiBD,iBAAiB;QAC1DH,OAAO,MAAMX,cAAM,CAACa,UAAU,CAAC,gCAAgCC,iBAAiB;QAEhF,0DAA0D;QAC1DH,OAAOtB,MAAMC,OAAO,EAAE0B,GAAG,CAACC,gBAAgB;QAC1CN,OAAOtB,MAAMG,KAAK,EAAEwB,GAAG,CAACC,gBAAgB;IAC1C;AACF"}